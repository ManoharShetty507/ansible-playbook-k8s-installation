    - name: Install kubectl
      apt:
        name: kubectl
        state: present

    - name: Reboot all the Kubernetes nodes
      reboot:
        post_reboot_delay: 60
        reboot_timeout: 80
        connect_timeout: 300
        test_command: uptime

    - name: Fetch kube config file from remote server to Ansible control node
      ansible.builtin.fetch:
        src: /home/ansible-user/.kube/config
        dest: /path/on/ansible/control/node/config
        flat: yes

- name: Set ownership and permissions of fetched config file on Ansible control node
  ansible.builtin.file:
    path: /home/ansible-user/.kube/config
    owner: ansible-user
    group: ansible-user
    mode: "0644"
    state: file
